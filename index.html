<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Data Search dari Google Sheet</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    body {
      background-color: #f9f9f9;
    }
    .btn-primary {
      background-color: #e60000;
      border-color: #e60000;
    }
    .btn-primary:hover {
      background-color: #cc0000;
      border-color: #cc0000;
    }
    .table thead {
      background-color: #e60000;
      color: white;
    }
    .modal-header {
      background-color: #e60000;
      color: white;
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <h1 class="mb-4 text-center">Pencarian Data Outlet</h1>

    <div class="row g-2 mb-3">
      <div class="col-12 col-md-3">
        <select id="filterType" class="form-select">
          <option value="ID">ID</option>
          <option value="Nama Outlet">Nama Outlet</option>
          <option value="Sales Force">Sales Force</option>
        </select>
      </div>
      <div class="col-12 col-md-6">
        <input type="text" id="searchInput" class="form-control" placeholder="Masukkan minimal 4 karakter...">
      </div>
      <div class="col-12 col-md-3">
        <button class="btn btn-primary w-100" onclick="filterData()">Cari</button>
      </div>
    </div>

    <div id="tableContainer" class="table-responsive d-none">
      <table class="table table-bordered table-striped">
        <thead class="table-dark">
          <tr>
            <th>Tgl</th>
            <th>Nama Outlet</th>
            <th>Sales Force</th>
            <th>Transaksi All</th>
            <th>Detail</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="detailModalLabel">Detail Outlet</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="modalContent">
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
    const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQTjeN7l-SSuGaD61pGJC4ECAS1e-O6BMVRsQsxe7Wh6eoN53fEKKK8RafV8Z--N2Svo5a4JtRlqEIA/pub?gid=0&single=true&output=csv";
    let allData = [];

    function loadSheetData() {
      Papa.parse(sheetURL, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
          allData = results.data;
        }
      });
    }

    function filterData() {
      const filterType = document.getElementById("filterType").value;
      const searchValue = document.getElementById("searchInput").value.trim().toLowerCase();

      if (searchValue.length < 4) {
        alert("Masukkan minimal 4 karakter untuk pencarian!");
        return;
      }

      const filtered = allData.filter(row => {
        const cellValue = (row[filterType] || '').toString().toLowerCase();
        return cellValue.includes(searchValue);
      });

      renderTable(filtered);
    }

    function renderTable(data) {
      const tableContainer = document.getElementById("tableContainer");
      const tableBody = document.getElementById("tableBody");

      tableBody.innerHTML = "";

      data.forEach((row, index) => {
        tableBody.innerHTML += `
          <tr>
            <td>${row['Tgl'] || ''}</td>
            <td>${row['Nama Outlet'] || ''}</td>
            <td>${row['Sales Force'] || ''}</td>
            <td>${row['Transaksi All'] || ''}</td>
            <td><button class="btn btn-sm btn-info" onclick="showDetail(${index})">Detail</button></td>
          </tr>
        `;
      });

      tableContainer.classList.remove("d-none");
    }

    function showDetail(index) {
      const d = allData[index];
      const content = `
        âœ® ğŸ…¿ğŸ…´ğŸ†ğŸ…µğŸ…¾ğŸ†ğŸ…¼ğŸ…°ğŸ…½ğŸ…²ğŸ…´ ğŸ…¾ğŸ†„ğŸ†ƒğŸ…»ğŸ…´ğŸ†ƒ âœ®<br><br>
        <b>Update Tgl</b> = ${d['Tgl']}<br>
        -------------------------------------<br>
        ğŸ”‘ <b>Id</b> = ${d['ID']}<br>
        ğŸ”–ï¸ï¸ <b>Nama Outlet</b> = ${d['Nama Outlet']}<br>
        ğŸ“ <b>No Rs</b> = ${d['No Rs']}<br>
        ğŸ™â€â™‚ï¸ <b>Sales Force</b> = ${d['Sales Force']}<br>
        ğŸ—“ï¸ <b>Hari</b> = ${d['Hari']}<br>
        ğŸ¦ <b>Tap</b> = ${d['Tap']}<br>
        ğŸ¦ <b>Cluster</b> = ${d['Cluster']}<br>
        -------------------------------------<br>
        ğŸ“Œ <b>Transaksi ALL</b> = ${d['Transaksi All']}<br>
        ğŸ“Œ <b>%MoM</b> = ${d['%MoM']}<br>
        ğŸ“Œ <b>Ket</b> = ${d['OP All Transaksi']}<br>
        ğŸ’° <b>Revenue ALL</b> = ${d['Revenue All']}<br>
        -------------------------------------<br>
        ğŸ“Œ <b>Transaksi CVM</b> = ${d['CVM']}<br>
        ğŸ“Œ <b>%MoM</b> = ${d['%MoM .1']}<br>
        ğŸ“Œ <b>Ket</b> = ${d['OP CVM']}<br>
        ğŸ’° <b>Revenue CVM</b> = ${d['Revenue CVM']}<br>
        -------------------------------------<br>
        ğŸ“Œ <b>ST SP</b> = ${d['ST SP']}<br>
        ğŸ“Œ <b>%MoM</b> = ${d['%MoM .2']}<br>
        ğŸ“Œ <b>Ket</b> = ${d['OA ST SP']}<br>
        -------------------------------------<br>
        ğŸ“Œ <b>SO SP</b> = ${d['SO SP']}<br>
        ğŸ“Œ <b>%MoM</b> = ${d['%MoM .3']}<br>
        ğŸ“Œ <b>Ket</b> = ${d['OA SO SP']}<br>
        -------------------------------------<br>
        ğŸ“Œ <b>ST VF</b> = ${d['ST VF']}<br>
        ğŸ“Œ <b>%MoM</b> = ${d['%MoM .4']}<br>
        ğŸ“Œ <b>Ket</b> = ${d['OP ST VF']}<br>
        -------------------------------------<br>
        ğŸ“Œ <b>SO VF</b> = ${d['SO VF']}<br>
        ğŸ“Œ <b>%MoM</b> = ${d['%MoM .5']}<br>
        ğŸ“Œ <b>Ket</b> = ${d['OP SO VF']}<br>
        -------------------------------------<br>
        ã€ï»¿ï¼¦ï¼¯ï¼«ï¼µï¼³ã€‘ = ${d['Nama Outlet']}<br>
        ğŸ‘‡  ğŸ‘‡  ğŸ‘‡  ğŸ‘‡<br>
        âš ï¸<b>Trx ALL</b> = ${d['Transaksi All']}<br>
        âš ï¸<b>Trx CVM</b> = ${d['CVM']}<br>
        âš ï¸<b>ST SP</b> = ${d['ST SP']}<br>
        âš ï¸<b>SO SP</b> = ${d['SO SP']}<br>
        âš ï¸<b>ST VF</b> = ${d['ST VF']}<br>
        âš ï¸<b>SO VF</b> = ${d['SO VF']}<br>
        -------------------------------------<br>
        ğ““ğ“²ğ“²ğ“·ğ“°ğ“ªğ“½ğ“´ğ“ªğ“· & ğ““ğ“²ğ“®ğ“­ğ“¾ğ“´ğ“ªğ“¼ğ“² ğ“›ğ“ªğ“°ğ“² ğ“ğ“¾ğ“½ğ“µğ“®ğ“½ ğ”‚ğ“ªğ“·ğ“° ğ“‘ğ“®ğ“µğ“¾ğ“¶ ğ“£ğ“»ğ“ªğ“·ğ“¼ğ“ªğ“´ğ“¼ğ“² â€¼ï¸
      `;

      document.getElementById("modalContent").innerHTML = content;
      new bootstrap.Modal(document.getElementById('detailModal')).show();
    }

    loadSheetData();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
