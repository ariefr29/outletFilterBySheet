<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Data Search dari Google Sheet</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    body {
      background-color: #f9f9f9;
    }
    .btn-primary {
      background-color: #e60000;
      border-color: #e60000;
    }
    .btn-primary:hover {
      background-color: #cc0000;
      border-color: #cc0000;
    }
    .table thead {
      background-color: #e60000;
      color: white;
    }
    .modal-header {
      background-color: #e60000;
      color: white;
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <h1 class="mb-4 text-center">Pencarian Data Outlet</h1>

    <div class="row g-2 mb-3">
      <div class="col-12 col-md-3">
        <select id="filterType" class="form-select">
          <option value="ID">ID</option>
          <option value="Nama Outlet">Nama Outlet</option>
          <option value="Sales Force">Sales Force</option>
        </select>
      </div>
      <div class="col-12 col-md-6">
        <input type="text" id="searchInput" class="form-control" placeholder="Masukkan minimal 4 karakter...">
      </div>
      <div class="col-12 col-md-3">
        <button id="searchButton" class="btn btn-primary w-100">Cari</button>
      </div>
    </div>

    <div id="tableContainer" class="table-responsive d-none">
      <table class="table table-bordered table-striped">
        <thead>
          <tr>
            <th>Tgl</th>
            <th>Nama Outlet</th>
            <th>Sales Force</th>
            <th>Transaksi All</th>
            <th>Detail</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="detailModalLabel">Detail Outlet</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="modalContent">
          </div>
        </div>
      </div>
    </div>

  </div>

<script>
  const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ5GHQCKwdkHB44V2Z7lS6qQ8YkFd5FagUHZ3xXRLuxdl-41XSdlXznAjeGNErOxJbYA_9M3LJ330wA/pub?output=csv";

  let allData = [];
  let headers = []; // Menyimpan nama kolom dari sheet
  let filteredData = [];

  function loadSheetData() {
    Papa.parse(sheetURL, {
      download: true,
      header: false, // ubah ke false agar bisa ambil raw data
      skipEmptyLines: true,
      complete: function(results) {
        headers = results.data[0];     // baris pertama = header
        allData = results.data.slice(1); // sisanya = data
      }
    });
  }

  function filterData() {
    const filterType = document.getElementById("filterType").value;
    const searchValue = document.getElementById("searchInput").value.trim().toLowerCase();

    if (searchValue.length < 4) {
      alert("Masukkan minimal 4 karakter untuk pencarian!");
      return;
    }

    const filterIndex = headers.indexOf(filterType);
    if (filterIndex === -1) {
      alert("Kolom pencarian tidak ditemukan!");
      return;
    }

    filteredData = allData.filter(row => {
      const cellValue = (row[filterIndex] || '').toString().toLowerCase();
      return cellValue.includes(searchValue);
    });

    renderTable(filteredData);
  }

  function renderTable(data) {
    const tableContainer = document.getElementById("tableContainer");
    const tableBody = document.getElementById("tableBody");

    tableBody.innerHTML = "";

    let html = "";
    data.forEach((row, index) => {
      html += `
        <tr>
          <td>${row[headers.indexOf('Tgl')] || ''}</td>
          <td>${row[headers.indexOf('Nama Outlet')] || ''}</td>
          <td>${row[headers.indexOf('Sales Force')] || ''}</td>
          <td>${row[headers.indexOf('Transaksi All')] || ''}</td>
          <td><button class="btn btn-sm btn-info detail-btn" data-index="${index}">Detail</button></td>
        </tr>
      `;
    });
    tableBody.innerHTML = html;

    tableContainer.classList.remove("d-none");

    document.querySelectorAll(".detail-btn").forEach(button => {
      button.addEventListener("click", function() {
        const index = this.getAttribute("data-index");
        showDetail(index);
      });
    });
  }

  function showDetail(index) {
    const d = filteredData[index];
    let content = `âœ® ğŸ…¿ğŸ…´ğŸ†ğŸ…µğŸ…¾ğŸ†ğŸ…¼ğŸ…°ğŸ…½ğŸ…²ğŸ…´ ğŸ…¾ğŸ†„ğŸ†ƒğŸ…»ğŸ…´ğŸ†ƒ âœ®<br><br>`;

    // Contoh ngeloop semua data untuk tampilkan dinamis
    headers.forEach((header, i) => {
      content += `<b>${header}</b> = ${d[i] || ''}<br>`;
    });

    document.getElementById("modalContent").innerHTML = content;
    new bootstrap.Modal(document.getElementById('detailModal')).show();
  }

  document.addEventListener("DOMContentLoaded", function() {
    loadSheetData();
    document.getElementById("searchButton").addEventListener("click", filterData);
  });
</script>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
